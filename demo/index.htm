<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>kline</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=0"/>
  <style>
    html,body{
      font:12px/1.5 Arial;
      word-break:break-all;
    }
    textarea{
      display:block;
      width:90%;
      height:200px;
    }
    form>button,#sub{
      display:inline-block;
      padding:0;
      width:100px;
      height:30px;
      background:#FED;
      font-size:14px;
      border:1px solid #CBA;
      border-radius:3px;
    }
    #con{
      position:relative;
      width:300px;
    }
    canvas{
      display:block;
    }
    #h{
      position:absolute;
      left:0;
      top:0;
      bottom:10px;
      border-left:1px dashed #FC9;
      opacity:0.8;
    }
    #top{
      position:absolute;
      left:0;
      top:0;
    }
    #top b{
      display:inline-block;
      color:#FFF;
      background:#39F;
      margin-left:-50%;
      font-weight:400;
      padding:0 3px;
      border-radius:2px;
      opacity:0.8;
      white-space:nowrap;
    }
    #con>span{
      display:none;
    }
    #con.show>span{
      display:block;
    }
  </style>
</head>
<body>
<div id="con">
  <canvas id="canvas" width="600" height="300" style="width:300px;height:150px;"></canvas>
  <span id="h"></span>
  <span id="top"><b></b></span>
</div>
<form>
  <textarea></textarea>
  <input type="submit" id="sub"/>
</form>
<script src="core.js"></script>
<script src="event.js"></script>
<script src="sea.js"></script>
<script>
  seajs.use('../init', function(KLine) {
    var search = location.search || '';
    search = search.replace(/^\?/, '');
    search = JSON.parse(decodeURIComponent(search) || '{}') || {};
    search.data = search.data || [{"max":1095.0126083567739,"min":958.3540671970695,"open":1095.0126083567739,"close":958.3540671970695,"volume":152.13158493861556},{"max":1040.7092065550387,"min":950.8868260774761,"open":990.3594173491001,"close":1040.7092065550387,"volume":179.23559197224677},{"max":1073.8737169653177,"min":923.9836546592414,"open":1073.8737169653177,"close":998.015439324081,"volume":27.736485516652465},{"max":977.7471837587655,"min":918.0072646588087,"open":938.0145435221493,"close":918.0072646588087,"volume":47.30222285725176},{"max":1001.1067807674408,"min":917.9852116387337,"open":917.9852116387337,"close":1001.1067807674408,"volume":123.3446171041578},{"max":1039.1496530734003,"min":991.3389762397856,"open":1039.1496530734003,"close":991.3389762397856,"volume":27.43791057728231},{"max":1034.210202889517,"min":902.618557959795,"open":1034.210202889517,"close":902.618557959795,"volume":46.82530607096851},{"max":965.0607516523451,"min":926.8606396857649,"open":965.0607516523451,"close":946.8500514980406,"volume":78.94244315102696},{"max":1022.1615431364626,"min":998.6298084259033,"open":998.6298084259033,"close":1022.1615431364626,"volume":150.5405092611909},{"max":1007.5619200244546,"min":924.0216203033924,"open":1007.5619200244546,"close":999.0598245989531,"volume":27.425807481631637},{"max":1097.0690711401403,"min":952.3663277737796,"open":952.3663277737796,"close":1097.0690711401403,"volume":137.11666548624635},{"max":1022.240950120613,"min":984.5456838607788,"open":1020.2630183659494,"close":1022.240950120613,"volume":187.09688424132764},{"max":1099.5674493256956,"min":934.5965664833784,"open":1081.5858582034707,"close":1099.5674493256956,"volume":36.66177811101079},{"max":1035.8656336087734,"min":969.4013610482216,"open":1035.8656336087734,"close":969.4013610482216,"volume":119.81885703280568},{"max":1039.7106771357358,"min":920.6714807543904,"open":953.5671511199325,"close":920.6714807543904,"volume":86.8257038295269},{"max":1089.4747210666537,"min":915.1414743158966,"open":1089.4747210666537,"close":929.1690303012729,"volume":163.8095622882247},{"max":987.9734336864203,"min":959.1955051291734,"open":969.01920507662,"close":959.1955051291734,"volume":103.8724072277546},{"max":1085.6954813469201,"min":905.9638352133334,"open":922.8971207048744,"close":905.9638352133334,"volume":121.62093706429005},{"max":1085.9412795398384,"min":1041.6069799102843,"open":1082.350625935942,"close":1084.8057204391807,"volume":89.68687634915113},{"max":1087.088616983965,"min":917.5799436401576,"open":1087.088616983965,"close":917.5799436401576,"volume":185.06506974808872},{"max":1075.3244583494961,"min":901.08631872572,"open":901.08631872572,"close":1075.3244583494961,"volume":82.75638753548265},{"max":1022.6707199588418,"min":900.2409957814962,"open":1022.6707199588418,"close":1012.3463625553995,"volume":2.563840989023447},{"max":950.782077293843,"min":925.4667192697525,"open":950.782077293843,"close":925.4667192697525,"volume":127.49720090068877},{"max":1065.9760521259159,"min":917.8758704569191,"open":1029.993492225185,"close":917.8758704569191,"volume":106.60762847401202},{"max":1063.9502741396427,"min":973.3172129839659,"open":1012.997584277764,"close":1063.9502741396427,"volume":42.10430746898055},{"max":1052.7872929815203,"min":914.1966694500297,"open":1052.7872929815203,"close":1040.078960871324,"volume":61.63067235611379},{"max":1077.7772981207818,"min":969.6073684375733,"open":1077.7772981207818,"close":1040.2535987086594,"volume":4.82812593691051},{"max":1060.9177520032972,"min":976.2244938872755,"open":976.2244938872755,"close":1060.9177520032972,"volume":138.93391913734376},{"max":1075.1479531638324,"min":1007.0842106360942,"open":1031.1217627022415,"close":1007.0842106360942,"volume":144.90600493736565},{"max":1091.4966760203242,"min":984.5771771855652,"open":1091.4966760203242,"close":984.5771771855652,"volume":165.4637754894793},{"max":1057.9432380851358,"min":950.0356647185981,"open":950.0356647185981,"close":1057.9432380851358,"volume":84.11499531939626},{"max":1092.707134829834,"min":954.0136368013918,"open":997.5853747222573,"close":954.0136368013918,"volume":82.34666674397886},{"max":1008.5810808464885,"min":978.6311398260295,"open":978.6311398260295,"close":1008.5810808464885,"volume":91.82840143330395},{"max":978.4522309433669,"min":916.2305407691747,"open":934.73652577959,"close":978.4522309433669,"volume":90.78838624991477},{"max":1041.9758154079318,"min":1018.1101514492184,"open":1018.1101514492184,"close":1041.9758154079318,"volume":21.495464770123363},{"max":1071.6026599984616,"min":913.2299249526113,"open":1071.6026599984616,"close":1057.8027375042439,"volume":186.49150440469384},{"max":1068.4703899081796,"min":1038.849179027602,"open":1068.4703899081796,"close":1038.849179027602,"volume":91.60016989335418},{"max":1094.2602133844048,"min":961.2398544326425,"open":1094.2602133844048,"close":1018.2219265028834,"volume":141.90901899710298},{"max":1062.9007078707218,"min":917.7465431857854,"open":1062.9007078707218,"close":987.918154662475,"volume":7.99424909055233},{"max":1029.934215405956,"min":969.6783899329603,"open":1025.2987863961607,"close":1006.4181455411017,"volume":148.2480438426137},{"max":1052.3526136763394,"min":976.9229530356824,"open":1039.6307926159352,"close":1052.3526136763394,"volume":106.2735449988395},{"max":1063.5802098084241,"min":920.0079551897943,"open":1063.5802098084241,"close":1003.692046739161,"volume":168.04452585056424},{"max":945.0826005078852,"min":906.1255828943104,"open":938.6050025932491,"close":945.0826005078852,"volume":13.232911145314574},{"max":1092.9699631407857,"min":930.200440203771,"open":1062.6124193426222,"close":964.1423877794296,"volume":122.21431233920157},{"max":1031.4710350707173,"min":932.7922848518938,"open":960.3848232887685,"close":997.9262421838939,"volume":0.8402744773775339},{"max":1058.321832260117,"min":918.8054470345378,"open":918.8054470345378,"close":978.6303052213043,"volume":77.75120949372649},{"max":1015.7013608608395,"min":947.8591058868915,"open":947.8591058868915,"close":1015.7013608608395,"volume":107.4978057295084},{"max":1068.792771641165,"min":909.5971421804279,"open":950.6482324097306,"close":909.5971421804279,"volume":6.85434895567596},{"max":1084.7346677444875,"min":946.5839636512101,"open":1014.2552352510393,"close":946.5839636512101,"volume":105.45715233311057},{"max":1094.2846625577658,"min":909.7736845258623,"open":909.7736845258623,"close":931.1929842457175,"volume":194.74915987811983},{"max":1034.369008662179,"min":943.612358905375,"open":943.612358905375,"close":1034.369008662179,"volume":83.20138114504516},{"max":1034.2894240282476,"min":908.4678821731359,"open":971.2843150831759,"close":934.0796195436269,"volume":63.61338817514479},{"max":1026.7449055798352,"min":974.3621472269297,"open":974.3621472269297,"close":1026.7449055798352,"volume":188.69965178892016},{"max":1065.4102915432304,"min":935.1717226207256,"open":1065.4102915432304,"close":1021.7785094399005,"volume":91.01420030929148},{"max":1090.1993087492883,"min":980.4279453586787,"open":980.4279453586787,"close":1006.1489133629948,"volume":38.838623417541385},{"max":975.0451381783932,"min":958.5179652553052,"open":975.0451381783932,"close":958.5179652553052,"volume":90.380564564839},{"max":1044.6725954767317,"min":960.435908427462,"open":1044.6725954767317,"close":960.435908427462,"volume":64.1018845140934},{"max":1087.5579304527491,"min":958.983797673136,"open":1087.5579304527491,"close":958.983797673136,"volume":84.85966664738953},{"max":1091.1412183195353,"min":909.2828387394547,"open":909.2828387394547,"close":1050.5719329230487,"volume":191.89141704700887},{"max":1089.7759119048715,"min":970.0706113129854,"open":1084.7302731126547,"close":983.21711756289,"volume":23.25795996002853},{"max":1054.6537509653717,"min":965.1231920346618,"open":971.7950658407062,"close":965.1231920346618,"volume":159.67651288956404},{"max":1041.4368995465338,"min":916.0359926987439,"open":1040.1436700951308,"close":916.0359926987439,"volume":130.41533934883773},{"max":1092.653782851994,"min":1056.1724862549454,"open":1092.653782851994,"close":1056.1724862549454,"volume":9.89926178008318},{"max":1084.1518090106547,"min":956.2748004682362,"open":1084.1518090106547,"close":956.2748004682362,"volume":78.34902238100767},{"max":1093.3577376883477,"min":926.498365867883,"open":1093.3577376883477,"close":926.498365867883,"volume":164.56073559820652},{"max":1086.9651682209224,"min":924.5801486074924,"open":924.5801486074924,"close":1086.9651682209224,"volume":147.6777344942093},{"max":1084.023747034371,"min":1019.3896371405572,"open":1084.023747034371,"close":1031.4033091068268,"volume":39.28626389242709},{"max":1049.7203241102397,"min":904.7553942073137,"open":906.1020218767226,"close":904.7553942073137,"volume":127.81630172394216},{"max":1004.1819239035249,"min":921.2851027958095,"open":1004.1819239035249,"close":921.2851027958095,"volume":160.41358513757586},{"max":1057.3404416441917,"min":984.7144611179829,"open":1057.3404416441917,"close":984.7144611179829,"volume":32.11307744495571},{"max":1077.3497242480516,"min":913.4617385454476,"open":913.4617385454476,"close":1054.537580581382,"volume":68.17002985626459},{"max":995.5842849332839,"min":900.1945268828422,"open":992.7583777811378,"close":930.016954569146,"volume":178.62646477296948},{"max":983.0254915170372,"min":912.295442353934,"open":912.295442353934,"close":983.0254915170372,"volume":109.35728093609214},{"max":1023.9522496704012,"min":952.1075588651001,"open":1000.1053407788277,"close":985.1249334402382,"volume":189.4727391190827},{"max":1093.4017719700933,"min":936.9574525859207,"open":1084.0792471077293,"close":1054.165704967454,"volume":57.29987598024309},{"max":1057.8938314691186,"min":905.7421454694122,"open":1042.067286465317,"close":941.2760642357171,"volume":27.776320604607463},{"max":1077.4393522646278,"min":921.1713786702603,"open":1044.7083893232048,"close":995.606531156227,"volume":6.4117934089154005},{"max":1034.3369375448674,"min":985.0109784398228,"open":1034.3369375448674,"close":989.3358448054641,"volume":130.89842493645847},{"max":1064.8197572678328,"min":1035.0874252151698,"open":1064.8197572678328,"close":1035.0874252151698,"volume":46.99860322289169},{"max":1094.3448848091066,"min":1032.9094909597188,"open":1032.9094909597188,"close":1070.0978819746524,"volume":64.29220577701926},{"max":1013.8251707423478,"min":912.8073147963732,"open":982.9357117880136,"close":1013.8251707423478,"volume":77.88125039078295},{"max":1046.168320486322,"min":904.7567705158144,"open":904.7567705158144,"close":1046.168320486322,"volume":192.17653973028064},{"max":1060.7437655795366,"min":934.5095489174128,"open":946.4939440134913,"close":987.8451477270573,"volume":55.41169657371938},{"max":1012.415513349697,"min":920.4405927564949,"open":1012.415513349697,"close":939.972244668752,"volume":124.71570405177772},{"max":1088.8165181968361,"min":1053.5370865371078,"open":1056.6570800729096,"close":1053.5370865371078,"volume":114.97901263646781},{"max":1098.9744676742703,"min":916.7835917323828,"open":1098.9744676742703,"close":961.8005439639091,"volume":74.40726850181818},{"max":1077.7994580566883,"min":1051.1452863458544,"open":1051.1452863458544,"close":1077.7994580566883,"volume":147.8498407639563},{"max":1077.0593391731381,"min":988.1483434233814,"open":1033.2657329272479,"close":1077.0593391731381,"volume":172.29610607028008},{"max":1020.0589193031192,"min":1000.2397225704044,"open":1017.4340502824634,"close":1020.0589193031192,"volume":44.7338760830462},{"max":1062.9982620943338,"min":956.0857882723212,"open":961.0930426511914,"close":969.7146086487919,"volume":166.63687038235366},{"max":1062.5055348034948,"min":940.4360829852521,"open":971.2352682836354,"close":1062.5055348034948,"volume":149.62106444872916},{"max":966.8074442073703,"min":917.9266768973321,"open":917.9266768973321,"close":948.577400110662,"volume":9.101347625255585},{"max":1080.791213689372,"min":942.9450878873467,"open":1080.791213689372,"close":942.9450878873467,"volume":136.11601856537163},{"max":1056.2847371213138,"min":930.2027423866093,"open":1052.5191543623805,"close":1002.4421797599643,"volume":60.51504514180124},{"max":983.5481992922723,"min":923.0880627874285,"open":973.3155435882509,"close":983.5481992922723,"volume":190.13568172231317},{"max":1033.0001413356513,"min":918.09958727099,"open":1024.1278878878802,"close":918.3462269604206,"volume":178.56674483045936},{"max":1022.1347487997264,"min":924.4285885710269,"open":924.4285885710269,"close":942.0512388925999,"volume":171.30161132663488},{"max":1073.4579692594707,"min":912.2052631806582,"open":1018.6805803328753,"close":912.2052631806582,"volume":70.40328085422516},{"max":1040.5270935967565,"min":971.3340009562671,"open":971.3340009562671,"close":1040.5270935967565,"volume":72.60758159682155},{"max":1050.47725928016,"min":903.6960446741432,"open":903.6960446741432,"close":961.5898661315441,"volume":24.083367036655545}];

    var $textarea = $('textarea');
    $textarea.val(JSON.stringify(search, null, '  '));

    var $form = $('form');
    function cb() {
      location.href = '?' + encodeURIComponent(JSON.stringify(JSON.parse($textarea.val())));
    }
    $form.on('submit', function(e) {
      e.preventDefault();
      cb();
    });

    var kline = new KLine('#canvas', search.data, {
      width: 600,
      height: 300,
      fontSize: 20,
      padding:[10, 10, 10, 10],
      lineWidth: search.lineWidth || 1,
      curvature: search.curvature || 1,
      xNum: search.xNum || 25,
      yNum: search.yNum || 4,
      type: search.type,
      start: search.start || Date.now() - 1000 * 3600 * 24 * 100,
      end: search.end || Date.now(),
      offset: search.offset || 0,
      number: search.number || 10
    });

    var $con = $('#con');
    var $h = $('#h');
    var $top = $('#top');

    var x0 = $con.offset().left;
    function onStart(e) {
      e.preventDefault();
      var x;
      if(e.type.indexOf('touch') == 0) {
        x = e.touches[0].pageX - x0;
      }
      else {
        x = e.pageX - x0;
      }
      var item = kline.getCoord(x * 2);
      $h.css('left', item.x / 2 + 'px');
      $top.css('left', item.x / 2 + 'px');
      $top.find('b').text(item.date);
      if(e.type != 'mousemove') {
        $con.addClass('show');
      }
    }
    function onEnd() {
      $con.removeClass('show');
    }
    $con.on('touchstart', onStart);
    $con.on('touchmove', onStart);
    $con.on('mousedown', onStart);
    $con.on('mousemove', onStart);
    $(document.body).on('touchend', onEnd);
    $(document.body).on('touchcancel', onEnd);
    $(document.body).on('mouseup', onEnd);
  });
</script>
</body>
</html>