<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>kline</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=0"/>
  <style>
    html,body{
      font:12px/1.5 Arial;
      word-break:break-all;
    }
    textarea{
      display:block;
      width:90%;
      height:200px;
    }
    form>button,#sub{
      display:inline-block;
      padding:0;
      width:100px;
      height:30px;
      background:#FED;
      font-size:14px;
      border:1px solid #CBA;
      border-radius:3px;
    }
    #con{
      position:relative;
      width:300px;
    }
    canvas{
      display:block;
    }
    #h{
      position:absolute;
      left:0;
      top:0;
      bottom:10px;
      border-left:1px dashed #FC9;
      opacity:0.8;
    }
    #top{
      position:absolute;
      left:0;
      top:0;
    }
    #top b{
      display:inline-block;
      color:#FFF;
      background:#39F;
      margin-left:-50%;
      font-weight:400;
      padding:0 3px;
      border-radius:2px;
      opacity:0.8;
      white-space:nowrap;
    }
    #con>span{
      display:none;
    }
    #con.show>span{
      display:block;
    }
  </style>
</head>
<body>
<div id="con">
  <canvas id="canvas" width="600" height="300" style="width:300px;height:150px;"></canvas>
  <span id="h"></span>
  <span id="top"><b></b></span>
</div>
<form>
  <textarea></textarea>
  <input type="submit" id="sub"/>
</form>
<script src="core.js"></script>
<script src="event.js"></script>
<script src="sea.js"></script>
<script>
  seajs.use('../init', function(KLine) {
    var search = location.search || '';
    search = search.replace(/^\?/, '');
    search = JSON.parse(decodeURIComponent(search) || '{}') || {};
    search.data = search.data || [{"max":1095.01,"min":958.35,"open":1095.01,"close":958.35,"volume":152.13,"ma5":1042.44,"ma10":1028.72,"ma20":1069.01},{"max":1040.71,"min":950.89,"open":990.36,"close":1040.71,"volume":179.24,"ma5":955.73,"ma10":972.35,"ma20":1029},{"max":1073.87,"min":923.98,"open":1073.87,"close":998.02,"volume":27.74,"ma5":932,"ma10":1018.77,"ma20":977.47},{"max":977.75,"min":918.01,"open":938.01,"close":918.01,"volume":47.3,"ma5":925.28,"ma10":943.2,"ma20":967.36},{"max":1001.11,"min":917.99,"open":917.99,"close":1001.11,"volume":123.34,"ma5":998.13,"ma10":993.07,"ma20":930.6},{"max":1039.15,"min":991.34,"open":1039.15,"close":991.34,"volume":27.44,"ma5":1024.12,"ma10":1020.3,"ma20":1025.06},{"max":1034.21,"min":902.62,"open":1034.21,"close":902.62,"volume":46.83,"ma5":932.31,"ma10":1017.94,"ma20":939.11},{"max":965.06,"min":926.86,"open":965.06,"close":946.85,"volume":78.94,"ma5":928.9,"ma10":940.3,"ma20":960.34},{"max":1022.16,"min":998.63,"open":998.63,"close":1022.16,"volume":150.54,"ma5":999.62,"ma10":1007.78,"ma20":1011.87},{"max":1007.56,"min":924.02,"open":1007.56,"close":999.06,"volume":27.43,"ma5":997.95,"ma10":999.48,"ma20":990.28},{"max":1097.07,"min":952.37,"open":952.37,"close":1097.07,"volume":137.12,"ma5":1084.38,"ma10":959.09,"ma20":1076.44},{"max":1022.24,"min":984.55,"open":1020.26,"close":1022.24,"volume":187.1,"ma5":990.28,"ma10":1000.62,"ma20":1004.7},{"max":1099.57,"min":934.6,"open":1081.59,"close":1099.57,"volume":36.66,"ma5":1046.97,"ma10":1029.99,"ma20":1087},{"max":1035.87,"min":969.4,"open":1035.87,"close":969.4,"volume":119.82,"ma5":1032.11,"ma10":1011.73,"ma20":1032.07},{"max":1039.71,"min":920.67,"open":953.57,"close":920.67,"volume":86.83,"ma5":993,"ma10":1000.93,"ma20":934.89},{"max":1089.47,"min":915.14,"open":1089.47,"close":929.17,"volume":163.81,"ma5":980.92,"ma10":1023.92,"ma20":1035.87},{"max":987.97,"min":959.2,"open":969.02,"close":959.2,"volume":103.87,"ma5":981.79,"ma10":965.75,"ma20":964.12},{"max":1085.7,"min":905.96,"open":922.9,"close":905.96,"volume":121.62,"ma5":1084.79,"ma10":1000.56,"ma20":1030.03},{"max":1085.94,"min":1041.61,"open":1082.35,"close":1084.81,"volume":89.69,"ma5":1048.37,"ma10":1057.68,"ma20":1074.55},{"max":1087.09,"min":917.58,"open":1087.09,"close":917.58,"volume":185.07,"ma5":944.41,"ma10":1023.53,"ma20":945.18},{"max":1075.32,"min":901.09,"open":901.09,"close":1075.32,"volume":82.76,"ma5":1043.94,"ma10":1018.71,"ma20":1069.56},{"max":1022.67,"min":900.24,"open":1022.67,"close":1012.35,"volume":2.56,"ma5":1004.28,"ma10":1004.62,"ma20":1006.57},{"max":950.78,"min":925.47,"open":950.78,"close":925.47,"volume":127.5,"ma5":943.41,"ma10":944.2,"ma20":926.52},{"max":1065.98,"min":917.88,"open":1029.99,"close":917.88,"volume":106.61,"ma5":921.01,"ma10":1026.66,"ma20":959.24},{"max":1063.95,"min":973.32,"open":1013,"close":1063.95,"volume":42.1,"ma5":994.22,"ma10":1015.09,"ma20":1055.68},{"max":1052.79,"min":914.2,"open":1052.79,"close":1040.08,"volume":61.63,"ma5":967.37,"ma10":963.4,"ma20":960.36},{"max":1077.78,"min":969.61,"open":1077.78,"close":1040.25,"volume":4.83,"ma5":1002.52,"ma10":985.79,"ma20":973.02},{"max":1060.92,"min":976.22,"open":976.22,"close":1060.92,"volume":138.93,"ma5":1045.46,"ma10":996.05,"ma20":978.89},{"max":1075.15,"min":1007.08,"open":1031.12,"close":1007.08,"volume":144.91,"ma5":1066.39,"ma10":1035.71,"ma20":1027.35},{"max":1091.5,"min":984.58,"open":1091.5,"close":984.58,"volume":165.46,"ma5":1091.21,"ma10":1012.43,"ma20":1032.37},{"max":1057.94,"min":950.04,"open":950.04,"close":1057.94,"volume":84.11,"ma5":979.07,"ma10":957.61,"ma20":955.86},{"max":1092.71,"min":954.01,"open":997.59,"close":954.01,"volume":82.35,"ma5":1046.85,"ma10":1024,"ma20":1045.26},{"max":1008.58,"min":978.63,"open":978.63,"close":1008.58,"volume":91.83,"ma5":979.71,"ma10":998.23,"ma20":984.32},{"max":978.45,"min":916.23,"open":934.74,"close":978.45,"volume":90.79,"ma5":949.33,"ma10":948.17,"ma20":939.55},{"max":1041.98,"min":1018.11,"open":1018.11,"close":1041.98,"volume":21.5,"ma5":1022.96,"ma10":1033.18,"ma20":1028.87},{"max":1071.6,"min":913.23,"open":1071.6,"close":1057.8,"volume":186.49,"ma5":963.19,"ma10":1026.47,"ma20":929.53},{"max":1068.47,"min":1038.85,"open":1068.47,"close":1038.85,"volume":91.6,"ma5":1062.65,"ma10":1050.2,"ma20":1048.67},{"max":1094.26,"min":961.24,"open":1094.26,"close":1018.22,"volume":141.91,"ma5":990.18,"ma10":982.22,"ma20":997.42},{"max":1062.9,"min":917.75,"open":1062.9,"close":987.92,"volume":7.99,"ma5":997.49,"ma10":1019.94,"ma20":962.51},{"max":1029.93,"min":969.68,"open":1025.3,"close":1006.42,"volume":148.25,"ma5":973.3,"ma10":990.4,"ma20":996.41},{"max":1052.35,"min":976.92,"open":1039.63,"close":1052.35,"volume":106.27,"ma5":1045.34,"ma10":1047.22,"ma20":1037.75},{"max":1063.58,"min":920.01,"open":1063.58,"close":1003.69,"volume":168.04,"ma5":975.37,"ma10":1049.62,"ma20":999.13},{"max":945.08,"min":906.13,"open":938.61,"close":945.08,"volume":13.23,"ma5":933.6,"ma10":921.4,"ma20":939.64},{"max":1092.97,"min":930.2,"open":1062.61,"close":964.14,"volume":122.21,"ma5":936.75,"ma10":1077.24,"ma20":977.45},{"max":1031.47,"min":932.79,"open":960.38,"close":997.93,"volume":0.84,"ma5":1026.53,"ma10":984.43,"ma20":937.02},{"max":1058.32,"min":918.81,"open":918.81,"close":978.63,"volume":77.75,"ma5":930.04,"ma10":1044.49,"ma20":1003.28},{"max":1015.7,"min":947.86,"open":947.86,"close":1015.7,"volume":107.5,"ma5":1012.16,"ma10":959.07,"ma20":958.96},{"max":1068.79,"min":909.6,"open":950.65,"close":909.6,"volume":6.85,"ma5":973.38,"ma10":1001.79,"ma20":974.83},{"max":1084.73,"min":946.58,"open":1014.26,"close":946.58,"volume":105.46,"ma5":1044.06,"ma10":980.65,"ma20":1047.99},{"max":1094.28,"min":909.77,"open":909.77,"close":931.19,"volume":194.75,"ma5":1047.72,"ma10":934.46,"ma20":931.27},{"max":1034.37,"min":943.61,"open":943.61,"close":1034.37,"volume":83.2,"ma5":948.25,"ma10":994.42,"ma20":967.44},{"max":1034.29,"min":908.47,"open":971.28,"close":934.08,"volume":63.61,"ma5":923.48,"ma10":992.27,"ma20":971.73},{"max":1026.74,"min":974.36,"open":974.36,"close":1026.74,"volume":188.7,"ma5":1019.97,"ma10":1024.96,"ma20":991.02},{"max":1065.41,"min":935.17,"open":1065.41,"close":1021.78,"volume":91.01,"ma5":1026.35,"ma10":951.37,"ma20":1007.46},{"max":1090.2,"min":980.43,"open":980.43,"close":1006.15,"volume":38.84,"ma5":992.54,"ma10":981.65,"ma20":1057.92},{"max":975.05,"min":958.52,"open":975.05,"close":958.52,"volume":90.38,"ma5":963.17,"ma10":963.79,"ma20":963.35},{"max":1044.67,"min":960.44,"open":1044.67,"close":960.44,"volume":64.1,"ma5":993.4,"ma10":981.48,"ma20":1027.13},{"max":1087.56,"min":958.98,"open":1087.56,"close":958.98,"volume":84.86,"ma5":1084.54,"ma10":1053.62,"ma20":1019.72},{"max":1091.14,"min":909.28,"open":909.28,"close":1050.57,"volume":191.89,"ma5":1037.34,"ma10":1061.61,"ma20":956.18},{"max":1089.78,"min":970.07,"open":1084.73,"close":983.22,"volume":23.26,"ma5":1041.35,"ma10":987.22,"ma20":986.83},{"max":1054.65,"min":965.12,"open":971.8,"close":965.12,"volume":159.68,"ma5":984.71,"ma10":966.83,"ma20":1037.66},{"max":1041.44,"min":916.04,"open":1040.14,"close":916.04,"volume":130.42,"ma5":944.42,"ma10":920.41,"ma20":990.77},{"max":1092.65,"min":1056.17,"open":1092.65,"close":1056.17,"volume":9.9,"ma5":1067.3,"ma10":1059.64,"ma20":1058.05},{"max":1084.15,"min":956.27,"open":1084.15,"close":956.27,"volume":78.35,"ma5":1049.74,"ma10":976.31,"ma20":1068.97},{"max":1093.36,"min":926.5,"open":1093.36,"close":926.5,"volume":164.56,"ma5":949.65,"ma10":1004.44,"ma20":936.8},{"max":1086.97,"min":924.58,"open":924.58,"close":1086.97,"volume":147.68,"ma5":1014.78,"ma10":951.9,"ma20":983.31},{"max":1084.02,"min":1019.39,"open":1084.02,"close":1031.4,"volume":39.29,"ma5":1071.71,"ma10":1066.69,"ma20":1054.32},{"max":1049.72,"min":904.76,"open":906.1,"close":904.76,"volume":127.82,"ma5":1046.92,"ma10":992.9,"ma20":981.94},{"max":1004.18,"min":921.29,"open":1004.18,"close":921.29,"volume":160.41,"ma5":952.43,"ma10":923.15,"ma20":999.6},{"max":1057.34,"min":984.71,"open":1057.34,"close":984.71,"volume":32.11,"ma5":1030.1,"ma10":1020.1,"ma20":1021.15},{"max":1077.35,"min":913.46,"open":913.46,"close":1054.54,"volume":68.17,"ma5":1065.48,"ma10":1050.24,"ma20":941.88},{"max":995.58,"min":900.19,"open":992.76,"close":930.02,"volume":178.63,"ma5":961.83,"ma10":905.11,"ma20":900.73},{"max":983.03,"min":912.3,"open":912.3,"close":983.03,"volume":109.36,"ma5":973.56,"ma10":979.28,"ma20":920.49},{"max":1023.95,"min":952.11,"open":1000.11,"close":985.12,"volume":189.47,"ma5":994.17,"ma10":1015.74,"ma20":986.67},{"max":1093.4,"min":936.96,"open":1084.08,"close":1054.17,"volume":57.3,"ma5":1060.12,"ma10":967.02,"ma20":989.81},{"max":1057.89,"min":905.74,"open":1042.07,"close":941.28,"volume":27.78,"ma5":1049.37,"ma10":982.42,"ma20":1004.58},{"max":1077.44,"min":921.17,"open":1044.71,"close":995.61,"volume":6.41,"ma5":1005.71,"ma10":926.29,"ma20":1015.71},{"max":1034.34,"min":985.01,"open":1034.34,"close":989.34,"volume":130.9,"ma5":1031.68,"ma10":989.34,"ma20":1033.18},{"max":1064.82,"min":1035.09,"open":1064.82,"close":1035.09,"volume":47,"ma5":1061.52,"ma10":1062.62,"ma20":1052.58},{"max":1094.34,"min":1032.91,"open":1032.91,"close":1070.1,"volume":64.29,"ma5":1081.54,"ma10":1075.01,"ma20":1055.32},{"max":1013.83,"min":912.81,"open":982.94,"close":1013.83,"volume":77.88,"ma5":1012.4,"ma10":931.88,"ma20":994.54},{"max":1046.17,"min":904.76,"open":904.76,"close":1046.17,"volume":192.18,"ma5":955.66,"ma10":971.73,"ma20":908.16},{"max":1060.74,"min":934.51,"open":946.49,"close":987.85,"volume":55.41,"ma5":1023.71,"ma10":934.62,"ma20":966.71},{"max":1012.42,"min":920.44,"open":1012.42,"close":939.97,"volume":124.72,"ma5":986.61,"ma10":969.81,"ma20":982.11},{"max":1088.82,"min":1053.54,"open":1056.66,"close":1053.54,"volume":114.98,"ma5":1076.02,"ma10":1054.59,"ma20":1067.32},{"max":1098.97,"min":916.78,"open":1098.97,"close":961.8,"volume":74.41,"ma5":987.83,"ma10":1062.25,"ma20":994.82},{"max":1077.8,"min":1051.15,"open":1051.15,"close":1077.8,"volume":147.85,"ma5":1074.18,"ma10":1058.52,"ma20":1067.48},{"max":1077.06,"min":988.15,"open":1033.27,"close":1077.06,"volume":172.3,"ma5":1072.68,"ma10":992.23,"ma20":1014.74},{"max":1020.06,"min":1000.24,"open":1017.43,"close":1020.06,"volume":44.73,"ma5":1008.93,"ma10":1001.72,"ma20":1007},{"max":1063,"min":956.09,"open":961.09,"close":969.71,"volume":166.64,"ma5":966.19,"ma10":972.67,"ma20":1054.89},{"max":1062.51,"min":940.44,"open":971.24,"close":1062.51,"volume":149.62,"ma5":951.24,"ma10":998.29,"ma20":1055.44},{"max":966.81,"min":917.93,"open":917.93,"close":948.58,"volume":9.1,"ma5":938.63,"ma10":920.09,"ma20":940.62},{"max":1080.79,"min":942.95,"open":1080.79,"close":942.95,"volume":136.12,"ma5":986.75,"ma10":1010.58,"ma20":1034.27},{"max":1056.28,"min":930.2,"open":1052.52,"close":1002.44,"volume":60.52,"ma5":981.45,"ma10":941.66,"ma20":1001.12},{"max":983.55,"min":923.09,"open":973.32,"close":983.55,"volume":190.14,"ma5":950.41,"ma10":956.41,"ma20":959.82},{"max":1033,"min":918.1,"open":1024.13,"close":918.35,"volume":178.57,"ma5":995.22,"ma10":919.57,"ma20":926.33},{"max":1022.13,"min":924.43,"open":924.43,"close":942.05,"volume":171.3,"ma5":987.97,"ma10":1019.58,"ma20":979.29},{"max":1073.46,"min":912.21,"open":1018.68,"close":912.21,"volume":70.4,"ma5":1057.7,"ma10":957.38,"ma20":986.7},{"max":1040.53,"min":971.33,"open":971.33,"close":1040.53,"volume":72.61,"ma5":975.56,"ma10":991.86,"ma20":1022.55},{"max":1050.48,"min":903.7,"open":903.7,"close":961.59,"volume":24.08,"ma5":997.33,"ma10":911.97,"ma20":995.74}];

    var $textarea = $('textarea');
    $textarea.val(JSON.stringify(search, null, '  '));

    var $form = $('form');
    function cb() {
      location.href = '?' + encodeURIComponent(JSON.stringify(JSON.parse($textarea.val())));
    }
    $form.on('submit', function(e) {
      e.preventDefault();
      cb();
    });

    var kline = new KLine('#canvas', search.data, {
      width: 600,
      height: 300,
      fontSize: 20,
      padding:[10, 10, 10, 10],
      lineWidth: search.lineWidth || 1,
      curvature: search.curvature || 1,
      xNum: search.xNum || 25,
      yNum: search.yNum || 4,
      type: search.type,
      start: search.start || Date.now() - 1000 * 3600 * 24 * 100,
      end: search.end || Date.now(),
      offset: search.offset || 0,
      number: search.number || 10,
      ma5: '#f1b94d',
      ma10: '#69b4f9',
      ma20: '#f37dd2'
    });

    var $con = $('#con');
    var $h = $('#h');
    var $top = $('#top');

    var x0 = $con.offset().left;
    function onStart(e) {
      e.preventDefault();
      if(e.touches[1]) {
        $con.removeClass('show');
        return;
      }
      var x;
      if(e.type.indexOf('touch') == 0) {
        x = e.touches[0].pageX - x0;
      }
      else {
        x = e.pageX - x0;
      }
      var item = kline.getCoord(x * 2);
      $h.css('left', item.x / 2 + 'px');
      $top.css('left', item.x / 2 + 'px');
      $top.find('b').text(item.date);
      if(e.type != 'mousemove') {
        $con.addClass('show');
      }
    }
    function onEnd(e) {
      if(e.touches[1]) {
        $con.addClass('show');
      }
      else {
        $con.removeClass('show');
      }
    }
    $con.on('touchstart', onStart);
    $con.on('touchmove', onStart);
    $con.on('mousedown', onStart);
    $con.on('mousemove', onStart);
    $(document.body).on('touchend', onEnd);
    $(document.body).on('touchcancel', onEnd);
    $(document.body).on('mouseup', onEnd);
  });
</script>
</body>
</html>